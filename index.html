<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÛŒÙ†Ù…Ø§Ø²Ù…ÙˆÙ† | Ø±Ù‚Ø§Ø¨Øª ÙÛŒÙ„Ù…ÛŒ</title>
    <style>
        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ (Ù‡Ù…Ø§Ù†Ù†Ø¯ Ú©Ø¯ Ù‚Ø¨Ù„) */
        @keyframes fadeIn { /* ... */ }
        /* ... Ø³Ø§ÛŒØ± Ø§Ù†ÛŒÙ…ÛŒØ´Ù†â€ŒÙ‡Ø§ ... */
        
        .difficulty-btns {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
        }
        .difficulty-btn {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
        }
        .easy { background: #4CAF50; }
        .medium { background: #FFC107; color: #000; }
        .hard { background: #F44336; }
        .share-code {
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 10px;
            margin: 15px 0;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ù‚Ø¨Ù„ÛŒ (ØµÙØ­Ù‡ Ø«Ø¨Øª Ù†Ø§Ù…/Ø¨Ø§Ø²ÛŒ) -->
    
    <!-- Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯: Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø·Ø­ Ø¯Ø´ÙˆØ§Ø±ÛŒ -->
    <div id="difficulty-screen" class="hidden">
        <h2>Ø³Ø·Ø­ Ø¯Ø´ÙˆØ§Ø±ÛŒ Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†</h2>
        <div class="difficulty-btns">
            <button class="difficulty-btn easy" onclick="startGame('easy')">Ø¢Ø³Ø§Ù†</button>
            <button class="difficulty-btn medium" onclick="startGame('medium')">Ù…ØªÙˆØ³Ø·</button>
            <button class="difficulty-btn hard" onclick="startGame('hard')">Ø³Ø®Øª</button>
        </div>
    </div>

    <!-- Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯: Ù†ØªÛŒØ¬Ù‡ Ø±Ù‚Ø§Ø¨Øª -->
    <div id="competition-result" class="hidden">
        <h2 id="result-title"></h2>
        <div id="vs-container" style="font-size: 24px; margin: 20px 0;">
            <span id="user-score">0</span> ğŸ†š <span id="ai-score">0</span>
        </div>
        <div id="result-message"></div>
        <div class="share-code" id="share-code"></div>
        <button onclick="saveCompetitionResult()">Ø°Ø®ÛŒØ±Ù‡ Ù†ØªÛŒØ¬Ù‡</button>
    </div>

    <script>
        // â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
        // â–ˆâ–ˆâ–ˆ Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯: Ø³ÛŒØ³ØªÙ… Ø±Ù‚Ø§Ø¨Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡ â–ˆâ–ˆâ–ˆ
        // â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

        // â€”â€” Û±. Ø±Ù‚Ø§Ø¨Øª Ø¨Ø§ Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ± â€”â€”
        function generateAIScore(difficulty) {
            const baseScore = Math.floor(Math.random() * 60) + 40; // 40-100
            switch(difficulty) {
                case 'easy': return baseScore - 15;
                case 'hard': return baseScore + 25;
                default: return baseScore;
            }
        }

        // â€”â€” Û². Ø¬Ø¯ÙˆÙ„ Ø±Ù‚Ø§Ø¨Øª Ù‡ÙØªÚ¯ÛŒ â€”â€”
        const weeklyLeaderboard = JSON.parse(localStorage.getItem('weeklyLB')) || [];
        
        function updateLeaderboard(userScore, aiScore) {
            weeklyLeaderboard.push({
                name: currentUser.username,
                userScore,
                aiScore,
                date: new Date().toLocaleDateString('fa-IR'),
                timestamp: Date.now()
            });
            
            // ÙÙ‚Ø· Û±Û°Û° Ø±Ú©ÙˆØ±Ø¯ Ø¢Ø®Ø± Ù†Ú¯Ù‡ Ø¯Ø§Ø±
            if(weeklyLeaderboard.length > 100) weeklyLeaderboard.shift();
            
            localStorage.setItem('weeklyLB', JSON.stringify(weeklyLeaderboard));
        }

        // â€”â€” Û³. Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù†ØªØ§ÛŒØ¬ â€”â€”
        function generateShareCode(userScore, aiScore) {
            return btoa(JSON.stringify({
                n: currentUser.username,
                s: userScore,
                a: aiScore,
                d: new Date().toLocaleDateString('fa-IR'),
                v: "1.0"
            }));
        }

        // â€”â€” Û´. Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡ Ø±Ù‚Ø§Ø¨Øª â€”â€”
        function showCompetitionResult(userScore, aiScore) {
            const resultTitle = document.getElementById("result-title");
            const resultMessage = document.getElementById("result-message");
            
            document.getElementById("user-score").textContent = userScore;
            document.getElementById("ai-score").textContent = aiScore;
            
            if(userScore > aiScore) {
                resultTitle.textContent = "ğŸ‰ Ø´Ù…Ø§ Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯ÛŒØ¯!";
                resultMessage.innerHTML = `Ø§Ù…ØªÛŒØ§Ø² Ø´Ù…Ø§ <strong>${userScore}</strong> Ø§Ø² ${totalQuestions}`;
            } else {
                resultTitle.textContent = "ğŸ¤– Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ± Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯!";
                resultMessage.innerHTML = `Ø§Ù…ØªÛŒØ§Ø² Ø´Ù…Ø§ <strong>${userScore}</strong> Ø§Ø² ${totalQuestions}`;
            }
            
            document.getElementById("share-code").textContent = 
                `Ú©Ø¯ Ù†ØªÛŒØ¬Ù‡: ${generateShareCode(userScore, aiScore)}`;
            
            document.getElementById("game-screen").classList.add("hidden");
            document.getElementById("competition-result").classList.remove("hidden");
        }

        // â€”â€” Ûµ. Ø°Ø®ÛŒØ±Ù‡ Ù†ØªÛŒØ¬Ù‡ â€”â€”
        function saveCompetitionResult() {
            const userScore = parseInt(document.getElementById("user-score").textContent);
            const aiScore = parseInt(document.getElementById("ai-score").textContent);
            
            updateLeaderboard(userScore, aiScore);
            alert("Ù†ØªÛŒØ¬Ù‡ Ø¯Ø± Ø¬Ø¯ÙˆÙ„ Ø±Ù‚Ø§Ø¨Øª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!");
            backToMain();
        }

        // â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
        // â–ˆâ–ˆâ–ˆ ØªØºÛŒÛŒØ±Ø§Øª Ø¯Ø± ØªÙˆØ§Ø¨Ø¹ Ù…ÙˆØ¬ÙˆØ¯ â–ˆâ–ˆâ–ˆ
        // â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

        // â€”â€” ØªØºÛŒÛŒØ± Ø¯Ø± ØªØ§Ø¨Ø¹ startGame â€”â€”
        function startGame(difficulty) {
            // ... Ú©Ø¯Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ ...
            
            // Ø¨Ø¹Ø¯ Ø§Ø² Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ:
            const aiScore = generateAIScore(difficulty);
            showCompetitionResult(finalScore, aiScore);
        }

        // â€”â€” ØªØºÛŒÛŒØ± Ø¯Ø± ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ â€”â€”
        function showMainMenu() {
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ø¬Ø¯ÙˆÙ„ Ø±Ù‚Ø§Ø¨Øª
            const html = `
                <button id="competition-btn">Ø±Ù‚Ø§Ø¨Øª Ø¨Ø§ Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ±</button>
                <button id="leaderboard-btn">Ø¬Ø¯ÙˆÙ„ Ø±Ù‚Ø§Ø¨Øª Ù‡ÙØªÚ¯ÛŒ</button>
            `;
            document.getElementById("main-menu").innerHTML += html;
            
            document.getElementById("competition-btn").addEventListener("click", () => {
                document.getElementById("difficulty-screen").classList.remove("hidden");
            });
        }
    </script>
</body>
</html>
